---
format_version: 1.3.1
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
trigger_map:
- push_branch: "*ios*"
  workflow: beta
- pull_request_source_branch: "*"
  workflow: beta
  pull_request_target_branch: dev

app:
  envs:
  - opts:
      is_expand: false
    BITRISE_PROJECT_PATH: ios/WinAdmCockpit.xcodeproj
  - opts:
      is_expand: false
    BITRISE_SCHEME: WinAdmCockpit
  - opts:
      is_expand: true
    SLACK_BITRISE_WEBHOOK_URL: "$SLACK_URL"
  - opts:
      is_expand: true
    IOS_BUILD_DIR: "$BITRISE_SOURCE_DIR/ios/build"
  - opts:
      is_expand: true
    FASTLANE_EXPLICIT_OPEN_SIMULATOR: 1

workflows:
  beta:
    steps:
    - script@1.1.3:
        inputs:
        - content: echo "Hello ${MY_NAME}! ${BITRISE_SOURCE_DIR}"
    - activate-ssh-key@3.1.1: # setup SSH private key to pickup rep
            run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@3.4.2: {} # clone git rep
    - yarn@0.0.4:
            title: install dependencies
            inputs:
            - command: install
            - args: ''
    - yarn@0.0.4:
                title: install flow-bin
                inputs:
                - command: global add flow-bin
                - args: ''
    - install-react-native@0.9.1: {}
    - script@1.1.3:
        title: Prep test assets
        inputs:
        - content: |-
            #!/bin/bash
            make clean-api && make test
        - is_debug: 'yes'
    - react-native-bundle@1.0.3: {}
    - fastlane@2.3.9:
        title: "Screenshots \U0001F4F8"
        inputs:
        - lane: ios screenshot
    - script@1.1.3:
        title: "Zip screenshots \U0001F4F8"
        inputs:
        - content: |-
            #!/bin/bash
            zip -r $IOS_BUILD_DIR/screenshots.zip fastlane/screenshots
#    - amazon-s3-upload@3.1.3:
#        inputs:
#        - access_key_id: "$AWS_S3_ACCESS_KEY"
#        - secret_access_key: "$AWS_S3_SECRET_ACCESS_KEY"
#        - upload_bucket: "$AWS_S3_BUCKET"
#        - upload_local_path: "$IOS_BUILD_DIR/screenshots"
#        - acl_control: public-read
#        - aws_region: eu-central-1














